<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Assignment</title>
    
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 2rem;
        }

        .form-input {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        input {
            width: 100%;
            padding: 4px;
            border: 1px solid salmon;
            border-radius: 4px;
        }

        .btn {
            margin-top: 1rem;
        }

        .btn button{
            padding: 12px;
            background-color: aliceblue;
            color: black;
        }

    </style>
    </head>

    <body class="world-container">
        <h1>Add a Person</h1>

        <form id="personForm">

            <div class="form-input">
            <label for="name"> Name: </label>
            <input type="text" id="name" name="name" required>
            </div>
        <div class="form-input">
            <label for="occupation"> Occupation: </label> 
            <input type="text" id="occupation" name="occupation" required>
        </div>
        <div class="form-input">
            <label for="item"> Item: </label>
            <input type="text" id="item" name="item" required>
        </div>
        <div class ="btn"> 
            <button type="submit" 
                class="w-full py-3 px-4 bg-indigo-600 text-white font-semibold rounded-md shadow-lg hover:bg-indigo-700 transition duration-200">
                Submit
            </button>
        </div>
    </form>
        </div>

        <div id="containers">
            <h2>Added:</h2>
        </div>

        <script>
            const personForm = document.getElementById("personForm");
            const peopleContainer = document.getElementById('containers');

            async function fetchWorldData() {
                try {
                    const response = await fetch('/world');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const worldData = await response.json();
                    displayWorldData(worldData);
                } catch (error) {
                    console.error('Error fetching world data', error);
                    peopleContainer.innerHTML = '<h2>Error loading world data</h2>';
                }
            }

            function displayWorldData(worldData) {
                peopleContainer.innerHTML = '<h2>Current World Inhabitants:</h2>';

                if (worldData && worldData.inhabitants && worldData.inhabitants.length > 0) {
                    worldData.inhabitants.forEach(person => {
                        const personDiv = document.createElement('div');
                        personDiv.classList.add('person-entry');
                        personDiv.innerHTML = `
                            <p><strong>Name:</strong> ${person.name}</p>
                            <p><strong>Occupation (Role):</strong> ${person.role}</p>
                            <p><strong>Item:</strong> ${person.item || 'N/A'}</p>
                        `;
                        peopleContainer.appendChild(personDiv);
                    });
            } else {
                    peopleContainer.innerHTML += '<p>No inhabitants found in the world.</p>';
                }
            }
            personForm.addEventListener('submit', function(event) {
                event.preventDefault();

                const name = document.getElementById('name').value;
                const occupation = document.getElementById('occupation').value;
                const item = document.getElementById('item').value;

                const payload = {
                    action: 'add_inhabitant'
                    name: name,
                    role: role,
                    item: item
                };

                try {
                    const response = await fetch('/update', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                if (response.ok) {
                    console.log('Update Successful: ', result);
                    fetchWorldData();
                    personForm.reset();
                } else {
                    console.error("Updated Failed: ", result.error);
                    alert(`Error updating world: ${result.error}`);
                }
            } catch (error) {
                console.error("Network Error", error);
                alert('Unexpected Error');
            }
        });
                fetchWorldData();
                </script>
                </body>
                </html>